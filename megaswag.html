<!DOCTYPE html>
<html>
<head>
    <title>Dane osobowe</title>
    <meta charset="utf-8"/>
    <script>
        function show(form){
            alert('Imię: '+form.firstName.value +
                '\nNazwisko: '+form.lastName.value +
                '\nPesel: '+form.pesel.value +
                '\nPłeć: '+form.gender.value +
                '\ndata urodzenia: '+form.birth.value);
        }
    </script>
</head>
<body>
<form onsubmit='show(this); return false;'>
    <div><label for='firstNameField'>Imię:</label>
        <input type="text" name='firstName'
               id='firstNameField'
               required='required'
               placeholder='Wpisz swoje imię'
               autofocus='autofocus' />
    </div>
    <div><label for='lastNameField'>Nazwisko:</label>
        <input type="text" name='lastName'
               id='lastNameField'
               required='required'
               placeholder='Wpisz swoje nazwisko'
        />
    </div>

    <label for="pesel" class="label">Pesel</label>
    <input id="pesel" type="number" class="input" required="required">
    <button id="button" class="button">Sprawdź</button>
    <span id="result" class="result"></span>
    <script>

        let sum = 0
        let checkDigit = 0
        const weights = [1, 3, 7, 9, 1, 3, 7, 9, 1, 3]

        const results = [
            {
                status: false,
                message: 'Pesel musi składać się z 11 cyfr',
            },
            {
                status: false,
                message: 'Pesel nieprawidłowy',
            },
            {
                status: true,
                message: 'Pesel prawidłowy',
            }
        ]

        year = {"0": "19", "1": "19", "2": "20", "3": "20", "4": "21", "5": "21", "6": "22", "7": "22",
            "8": "18", "9": "18"}
        monthSingleDigit= {"1": "01", "2": "02", "3": "03", "4": "04", "5": "05", "6": "06", "7": "07",
            "8": "08", "9": "09"}
        monthTwoDigit = {"0": "10", "1": "11", "2": "12"}

        const checkPesel = (pesel) => {

            //zamiana inputu na tablice typu Int
            let peselArr = pesel.split('')
            peselArr = peselArr.map((el) => parseInt(el))

            //tu podstawia do wzorku 1*a + 3*b + 7*c + 9*d + 1*e + 3*f + 7*g + 9*h + 1*i + 3*j || last == result
            peselArr.forEach((element, index, peselArr) => {
                if (index === peselArr.length - 1) return
                sum += parseInt(element) * parseInt(weights[index])
            })

            //sprawdzenie ostatniego indexu tablicy
            checkDigit = 10 - ( sum % 10 )

            //zwraca komunikat czy pesel jest poprawny
            //TODO naprawić błąd - po drugim wpisaniu peselu komunikat "niepoprawny pesel" niezaleznie od tego czy pesel jest poprawny czy nie
            //TODO zabezpieczenie przed wpisaniem liczby ujemnej
            if (peselArr.length !== 11) return results[0];
            if (checkDigit === peselArr[10]) return results[2];

            return results[1]
        }

        function getDate(pesel) {
            var monthLenght
            pesel[2] % 2 === 0 ? monthLenght = monthSingleDigit[pesel[3]] : monthLenght = monthTwoDigit[pesel[3]]
            return `${year[pesel[2]]}${pesel[0]}${pesel[1]}-${monthLenght}-${pesel[4]}${pesel[5]}`
        }

        function getGender(pesel){
           return pesel[9] % 2 === 0 ? "kobieta" : "mężczyzna"
        }

        //tego nie tykalem ale to do przycisku sie odnosi
        const button = document.querySelector('#button')
        const result = document.querySelector('#result')

        button.addEventListener('click', () => {

            const pesel = document.querySelector('#pesel').value
            const checkStatus = checkPesel(pesel)
            result.classList.remove('error', 'success')
            result.innerHTML = checkStatus.message

            //print w konsoli danych
            console.log(getDate(pesel))
            console.log(getGender(pesel))

            if (checkStatus.status === false) {
                result.classList.add('error')
            } else {
                result.classList.add('success')
            }

        })


    </script>

    <div><label for='genderRadio'>Płeć:</label></br>
        <input type="radio" id="kobieta" name="gender" value="kobieta" id="genderRadio" checked="checked">
        <label for="kobieta">Kobieta</label><br>
        <input type="radio" id="mezczyzna" name="gender" value="mezczyzna">
        <label for="mezczyzna">Mężczyzna</label><br>
    </div>

    <div><label for='birthField'>Data urodzenia </label>
        <input type="date" id="birthField" name="birth"
               required='required'>
    </div>

    <div><label for="robotCheckbox">Nie jestem robotem</label>
        <input type="checkbox" name="robotCheckbox" id="robotCheckbox" required="required"/></div>
    <button type="submit" onsubmit="show(form)">Zatwierdź</button>
</form>








</body>
</html>