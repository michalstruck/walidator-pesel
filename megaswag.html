
<!DOCTYPE html>
<html>
<head>
    <title>Dane osobowe</title>
    <meta charset="utf-8"/>
    <script>
        function show(form){
            alert('Imię: '+form.firstName.value +
                '\nNazwisko: '+form.lastName.value +
                '\nPesel: '+form.pesel.value +
                '\nPłeć: '+form.gender.value +
                '\ndata urodzenia: '+form.birth.value);
        }
    </script>
</head>
<body>
<form onsubmit='show(this); return false;'>
    <div><label for='firstNameField'>Imię:</label>
        <input type="text" name='firstName'
               id='firstNameField'
               required='required'
               placeholder='Wpisz swoje imię'
               autofocus='autofocus' />
    </div>
    <div><label for='lastNameField'>Nazwisko:</label>
        <input type="text" name='lastName'
               id='lastNameField'
               required='required'
               placeholder='Wpisz swoje nazwisko'
        />
    </div>
    <!--    <div><label for='peselField'>Pesel:</label>-->
    <!--        <input type="number" name='pesel'-->
    <!--               id='peselField'-->
    <!--               required='required'-->
    <!--               placeholder='Wpisz swoj pesel'-->
    <!--                />-->
    <!--    </div>-->


    <label for="pesel" class="label">Pesel</label>
    <input id="pesel" type="number" class="input" required="required">
    <button id="button" class="button">Sprawdź</button>
    <span id="result" class="result"></span>
    <script>
        const results = [
            {
                status: false,
                message: 'Pesel musi składać się z 11 cyfr',
            },
            {
                status: false,
                message: 'Pesel nieprawidłowy',
            },
            {
                status: true,
                message: 'Pesel prawidłowy',
            },
            {
                status: false,
                message: 'Nieprawidłowy typ danych',
            },
        ]

        const weights = [1, 3, 7, 9, 1, 3, 7, 9, 1, 3]

        const checkPesel = (pesel) => {
            if (typeof pesel !== 'string') return results[3]

            let peselArr = pesel.split('')
            peselArr = peselArr.map((el) => parseInt(el))

            let sum = 0
            let checkDigit = 0

            var year;
            var month;
            var day;
            var fullDate;
            var gender;

            if (peselArr.length !== 11) {
                return results[0]
            }

            peselArr.forEach((element, index, peselArr) => {
                if (index === peselArr.length - 1) return
                sum += parseInt(element) * parseInt(weights[index])
            })

            checkDigit = sum % 10
            checkDigit = 10 - checkDigit
            checkDigit = checkDigit % 10
            const lastPeselDigit = peselArr.length - 1


//ROK


            if(pesel[2] == 0 || pesel[2] == 1) {
                year = "19" + pesel[0].toString() + pesel[1].toString()
            }
            if (pesel[2] == 2 || pesel[2] == 3){
                year = "20" + pesel[0].toString() + pesel[1].toString()
            }

//MIESIĄC
            m= {"1": "01", "2": "02", "3": "03", "4": "04", "5": "05", "6": "06", "7": "07",
                "8": "08", "9": "09"}
            m2 = {"0": "10", "1": "11", "2": "12"}
//2000-2099
            if(pesel[2] == 2) {
                month = m[pesel[3]]
            }
            if(pesel[2] == 3){
                month = m2[pesel[3]]
            }
//1800-1899
            if (pesel[2] == 8)
            {
                month = m[pesel[3]]
            }
            if(pesel[2] == 9){
                month = m2[pesel[3]]
            }
            //1900-1999
            if(pesel[2] == 0)
            {
                month = m[pesel[3]]
            }
            if(pesel[2] == 1){
                month = m2[pesel[3]]
            }

//DZIEŃ
            day = pesel[4] + pesel[5]

            if((pesel[9] % 2) !== 0){
                gender = "mezczyzna";
            }else{
                gender = "kobieta";
            }

            fullDate = year + "-" + month + "-" + day;

            if (checkDigit === peselArr[lastPeselDigit]) {

                document.getElementById('birthField').value = fullDate;

                var radioElements = document.getElementsByName("gender");

                for (var i=0; i<radioElements.length; i++) {
                    if (radioElements[i].getAttribute('value') === gender) {
                        radioElements[i].checked = true;
                    }
                }


                return results[2]
            } else {
                return results[1]
            }
        }
    </script>
    <script>
        const button = document.querySelector('#button')
        const result = document.querySelector('#result')

        button.addEventListener('click', () => {

            const pesel = document.querySelector('#pesel').value
            const checkStatus = checkPesel(pesel)
            result.classList.remove('error', 'success')
            result.innerHTML = checkStatus.message

            if (checkStatus.status === false) {
                result.classList.add('error')
            } else {
                result.classList.add('success')
            }

        })
    </script>

    <div><label for='genderRadio'>Płeć:</label></br>
        <input type="radio" id="kobieta" name="gender" value="kobieta" id="genderRadio" checked="checked">
        <label for="kobieta">Kobieta</label><br>
        <input type="radio" id="mezczyzna" name="gender" value="mezczyzna">
        <label for="mezczyzna">Mężczyzna</label><br>
    </div>

    <div><label for='birthField'>Data urodzenia </label>
        <input type="date" id="birthField" name="birth"
               required='required'>
    </div>

    <div><label for="robotCheckbox">Nie jestem robotem</label>
        <input type="checkbox" name="robotCheckbox" id="robotCheckbox" required="required"/></div>
    <button type="submit" onsubmit="show(form)">Zatwierdź</button>
</form>








</body>
</html>